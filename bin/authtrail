#!/usr/bin/env ruby

# frozen_string_literal: true

require 'dry/cli'

require_relative '../config/mongoid'
require_relative '../app/models/audit_event'

module Authtrail
  class Cli
    extend Dry::CLI::Registry

    class Serve < Dry::CLI::Command
      desc 'tart dev server'
      def call(**)
        system 'ruby app/server.rb'
      end
    end

    class Specs < Dry::CLI::Command
      desc "run tests"
      def call(**)
        system 'bundle exec rspec'
      end
    end

    class Poke < Dry::CLI::Command
      desc 'does a dry test for the app and dependencies'

      def call(*)
        puts 'testing the mongo connection'
        puts "there are in total #{AuditEvent.count} records in the database for the audit events"
      end
    end

    register 'serve', Serve
    register 'specs', Specs
    register 'poke', Poke
  end
end


Dry::CLI.new(Authtrail::Cli).call
